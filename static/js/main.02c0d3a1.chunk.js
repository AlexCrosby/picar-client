(this["webpackJsonppicar-client"]=this["webpackJsonppicar-client"]||[]).push([[0],{54:function(e,n,t){},55:function(e,n,t){},92:function(e,n,t){"use strict";t.r(n);var o=t(1),c=t(0),a=t.n(c),i=t(40),s=t.n(i),r=(t(54),t(22)),d=(t(55),t(41)),l=t.n(d),u=null;var f=function(e){return(u=l()("http://picar1.duckdns.org:5000",{transports:["websocket"]})).on("status",(function(e){})),u.on("connect",(function(n){e("Connected"),console.log("Connected to piCar.")})),u.on("disconnect",(function(n){e("Disconnected"),console.log("Disconnected to piCar.")})),u},g=t(12);var h=function(e,n){function t(t){var o=t.key.toUpperCase();if(["W","A","S","D"].includes(o)){var c=Object(g.a)({},"Key"+o,0);n.emit("command",c),e(o)}}function o(t){var o=t.key.toUpperCase();if(!t.repeat&&["W","A","S","D"].includes(o)){var c=["W","S"].includes(o)?.5:1,a=Object(g.a)({},"Key"+o,c);n.emit("command",a),e(o)}}return window.addEventListener("keyup",t),window.addEventListener("keydown",o),function(){window.removeEventListener("keyup",t),window.removeEventListener("keydown",o)}},p=t(42),b=t(43),m=t(48),v=t(47),j=t(44),O=t.n(j),w=function(e){Object(m.a)(t,e);var n=Object(v.a)(t);function t(){return Object(p.a)(this,t),n.apply(this,arguments)}return Object(b.a)(t,[{key:"connectHandler",value:function(e){console.log("Gamepad ".concat(e," connected !"))}},{key:"disconnectHandler",value:function(e){console.log("Gamepad ".concat(e," disconnected !"))}},{key:"buttonChangeHandler",value:function(e,n){e in[""]&&console.log(e,n)}},{key:"axisChangeHandler",value:function(e,n,t){["LeftStickX","LeftTrigger","RightTrigger"].includes(e)&&(console.log(e,n),u.emit("command",Object(g.a)({},e,n)))}},{key:"buttonDownHandler",value:function(e){console.log(e,"down")}},{key:"buttonUpHandler",value:function(e){console.log(e,"up")}},{key:"render",value:function(){return Object(o.jsxs)("div",{children:[Object(o.jsx)("h2",{children:"Gamepad Stuff"}),Object(o.jsx)(O.a,{onConnect:this.connectHandler,onDisconnect:this.disconnectHandler,onButtonChange:this.buttonChangeHandler,onAxisChange:this.axisChangeHandler,children:Object(o.jsx)(a.a.Fragment,{})})]})}}]),t}(a.a.Component);var y=function(e,n,t,o,c){if("WebSocket"in window){console.log("opening web socket: "+e);var a,i=new WebSocket(e),s=[],r=!1;function d(){r&&(s.forEach((function(e){a.addIceCandidate(e,(function(){console.log("IceCandidate added: "+JSON.stringify(e))}),(function(e){console.error("addIceCandidate error: "+e)}))})),s=[])}i.onopen=function(){a=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302","stun:192.168.1.94:3478"]}]},{optional:[]}),s=[],r=!1,a.onicecandidate=function(e){if(e.candidate){var n={sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:e.candidate.candidate},t={what:"addIceCandidate",data:JSON.stringify(n)};i.send(JSON.stringify(t))}else console.log("end of candidates.")},"ontrack"in a?a.ontrack=function(e){console.log("pc.ontrack",e),"video"===e.track.kind&&n(e.streams[0])}:a.onaddstream=function(e){n(e.stream)},a.onremovestream=function(e){console.log("the stream has been removed: do your stuff now")},a.ondatachannel=function(e){console.log("a data channel is available: do your stuff with it")};var e={what:"call",options:{force_hw_vcodec:!1,vformat:30,trickle_ice:!0}};console.log("send message "+JSON.stringify(e)),i.send(JSON.stringify(e))},i.onmessage=function(e){var n=JSON.parse(e.data),o=n.what,l=n.data;switch(console.log("received message "+JSON.stringify(n)),o){case"offer":var u={optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};a.setRemoteDescription(new RTCSessionDescription(JSON.parse(l)),(function(){r=!0,d(),a.createAnswer((function(e){a.setLocalDescription(e);var n={what:"answer",data:JSON.stringify(e)};i.send(JSON.stringify(n))}),(function(e){t("failed to create answer: "+e)}),u)}),(function(e){t("failed to set the remote description: "+e),i.close()}));break;case"answer":break;case"message":c&&c(n.data);break;case"iceCandidate":if(!n.data){console.log("Ice Gathering Complete");break}var f=JSON.parse(n.data),g=new RTCIceCandidate({sdpMLineIndex:f.sdpMLineIndex,candidate:f.candidate});s.push(g),d();break;case"iceCandidates":for(var h=JSON.parse(n.data),p=0;h&&p<h.length;p++){f=h[p];var b=new RTCIceCandidate({sdpMLineIndex:f.sdpMLineIndex,candidate:f.candidate});s.push(b)}d()}},i.onclose=function(e){console.log("socket closed with code: "+e.code),a&&(a.close(),a=null,i=null),o&&o()},i.onerror=function(e){t("An error has occurred on the websocket (make sure the address is correct)!")},this.hangup=function(){if(i){var e={what:"hangup"};console.log("send message "+JSON.stringify(e)),i.send(JSON.stringify(e))}}}else t("Sorry, this browser does not support Web Sockets. Bye.")};var k=function(){var e=null,n=!1,t=document.getElementById("v");return document.getElementById("start"),document.getElementById("stop"),window.addEventListener("DOMContentLoaded",(function(){t=document.getElementById("v"),document.getElementById("start"),document.getElementById("stop")})),Object(o.jsxs)("div",{children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("button",{id:"start",onClick:function(){return function(){var o=(window.location.protocol,"wss://picar1.duckdns.org:8090/stream/webrtc");n||(console.log("create new signal"),e=new y(o,(function(e){console.log("got a stream!"),t.srcObject=e,t.play()}),(function(e){alert(e)}),(function(){console.log("websocket closed. bye bye!"),t.srcObject=null,n=!1}),(function(e){alert(e)})))}()},title:"If you do not see any video stream, make sure your browser supports the codec used within this demo (see the source code for details, or try Firefox or Chrome)",children:"Start Streaming"}),Object(o.jsx)("button",{id:"stop",onClick:function(){return console.log("signalObj"+e),void(e&&(console.log("STOP"),e.hangup(),e=null))},children:"Stop Streaming"})]}),Object(o.jsx)("video",{id:"v",controls:!0,width:640,height:480})]})};var C=function(){var e=Object(c.useState)("Init"),n=Object(r.a)(e,2),t=n[0],a=n[1],i=Object(c.useState)("None"),s=Object(r.a)(i,2),d=s[0],l=s[1],u=null;return Object(c.useEffect)((function(){u=f(a),h(l,u)}),[]),Object(o.jsxs)("div",{children:[Object(o.jsx)("h1",{children:"Car Stream"}),Object(o.jsxs)(o.Fragment,{children:["Status: ",t]}),Object(o.jsx)("br",{}),Object(o.jsxs)(o.Fragment,{children:["Last key pressed: ",d]}),Object(o.jsx)("div",{children:Object(o.jsx)(k,{})}),Object(o.jsx)(w,{deadZone:.1})]})},S=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,93)).then((function(n){var t=n.getCLS,o=n.getFID,c=n.getFCP,a=n.getLCP,i=n.getTTFB;t(e),o(e),c(e),a(e),i(e)}))},x=t(46);s.a.render(Object(o.jsx)(x.a,{basename:"/picar-client",children:Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(C,{})})}),document.getElementById("root")),S()}},[[92,1,2]]]);
//# sourceMappingURL=main.02c0d3a1.chunk.js.map